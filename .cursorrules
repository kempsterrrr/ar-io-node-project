# AR.IO Node Project - Cursor Rules

## Project Structure

```
ar-io-node-project/
├── apps/gateway/          # AR.IO gateway (Docker-based)
├── packages/              # Sidecar extensions
├── docs/                  # Detailed documentation
└── .github/workflows/     # CI/CD (ci.yml, deploy-gateway.yml)
```

**Stack:** Bun + Turborepo, Docker Compose, GitHub Actions → Hetzner

---

## Key Project-Specific Commands

```bash
# Gateway testing (port 3000, not 4000!)
cd apps/gateway
docker compose -f docker-compose.yaml -f docker-compose.dev.yaml up -d
./scripts/test-gateway.sh
curl -sL http://localhost:3000/ar-io/info

# Before committing
bun run format

# PR management
gh pr create --title "feat: ..." --body "..."
gh pr checks <NUMBER>
gh pr merge <NUMBER> --squash --delete-branch
```

---

## Critical Gotchas

1. **Branch protection is ON** - Cannot push to `main` directly. Always use PRs.
2. **Gateway runs on port 3000** - Envoy proxy, not 4000.
3. **Envoy needs TVAL_* variables** - Check `docker-compose.yaml` if envoy fails.
4. **CI must pass before merge** - Lint, Docker validation, Build, Security scan.
5. **Format before committing** - Run `bun run format` or CI will fail.

---

## When Making Changes

### Before Creating a PR

- Run `bun run format`
- Test gateway if touching `apps/gateway/`
- Use conventional commits: `feat:`, `fix:`, `chore:`, `docs:`

### After Merging

- Pull latest: `git checkout main && git pull`
- Check if Dependabot created new PRs: `gh pr list`

### When to Update These Rules

Update `.cursorrules` when:

- New workflows or CI checks are added
- Project structure changes significantly
- New gotchas are discovered
- Key commands change

---

## Where to Find Details

| Topic                | Location                               |
| -------------------- | -------------------------------------- |
| Testing guide        | `docs/TESTING.md`                      |
| Gateway setup        | `apps/gateway/README.md`               |
| Environment vars     | `apps/gateway/.env.example`            |
| CI configuration     | `.github/workflows/ci.yml`             |
| Deploy configuration | `.github/workflows/deploy-gateway.yml` |
| Dependabot config    | `.github/dependabot.yml`               |

---

## Adding Sidecars

Create in `packages/<name>/` with:

- `docker-compose.yaml` (must use `ar-io-network` external network)
- `package.json`, `Dockerfile`, `README.md`

See existing gateway structure as reference.
